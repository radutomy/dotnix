#!/bin/sh
set -e

export NIX_CONFIG="experimental-features = nix-command flakes"
echo "ðŸš€ Applying home-manager configuration..."
nix run home-manager/release-25.11 -- switch --flake ~/.config#"${USER}@$(hostname)"

# apply NixOS system-level overrides from hosts/desktop/system.nix
# (e.g. virtualisation.docker.enable) on top of /etc/nixos/configuration.nix
# skipped on macOS since /etc/nixos doesn't exist there
if [ -d /etc/nixos ]; then
  echo "ðŸ”§ Applying NixOS system configuration..."
  nixos-rebuild switch --flake ~/.config#nixos --impure
fi

echo "âœ… Done."
yadm remote set-url origin git@github.com:radutomy/dotnix.git
