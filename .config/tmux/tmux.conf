# Eliminate escape delay - do not remove this
set -s escape-time 0

# Use vi keys in copy mode
set -g mode-keys vi
set-option -g mouse on

# Scroll wheel in copy-mode-vi (3 lines at a time, exit at bottom)
bind-key -T copy-mode-vi WheelUpPane send-keys -X -N 3 scroll-up
bind-key -T copy-mode-vi WheelDownPane { send-keys -X -N 3 scroll-down; if -F "#{==:#{scroll_position},0}" "send -X cancel" }
# Ctrl+C copies selection or line (with flash)
bind -T copy-mode-vi C-c if -F "#{selection_present}" "send -X copy-selection" { send -X select-line; run "sleep 0.15"; send -X copy-selection }
# C-h/C-l work in scroll mode (stay in copy mode)
bind -T copy-mode-vi C-h previous-window
bind -T copy-mode-vi C-l next-window
# Escape exits copy mode
bind-key -T copy-mode-vi Escape send-keys -X cancel

# Don't rename windows automatically
set-option -g allow-rename off

set -g status-position top
set -g status-style bg=default,fg=white
set -g status-left ""
set -g status-right "#[fg=green] #(echo '#{pane_current_path}' | sed 's#$HOME#~#') "
set -g status-right-length 100

# Add visual gap with pane border
set -g pane-border-status top
set -g pane-border-format ""
set -g pane-border-style fg=#3a3a3a
set -g pane-active-border-style fg=#3a3a3a

# Tab/Window styling
setw -g window-status-style fg=silver,bg=default
setw -g window-status-current-style fg=white,bg=#C44300,bold
setw -g window-status-format " #I #W "
setw -g window-status-current-format " #I #W "

# Auto-create 5 default windows on new session
set-hook -g after-new-session 'run-shell "uname -r | grep -q orbstack && W=macos C=mac || W=pwsh C=pwsh.exe; \
tmux rename-window ide \\; new-window -n main \\; new-window -n term \\; split-window -v \\; select-pane -U \\; new-window -n aux \\; split-window -v \\; select-pane -U \\; new-window -n \$W \\; send-keys -t \$W \$C Enter \\; run-shell \"sleep 0.5\" \\; send-keys -t \$W \"cd && clear\" Enter \\; select-window -t 0"'

## Keybindings
# CTRL+h/j/k/l always handled by TMUX (no Neovim integration)
bind-key -n C-h previous-window
bind-key -n C-j select-pane -D
bind-key -n C-k select-pane -U
bind-key -n C-l next-window
# Ctrl+U/D scroll 10 lines (pass through to Neovim, exit copy mode at bottom)
bind -T copy-mode-vi C-u { send -X -N 10 scroll-up; send -X middle-line }
bind -T copy-mode-vi C-d { send -X -N 10 scroll-down; send -X middle-line; if -F "#{==:#{scroll_position},0}" 'send -X cancel' }
bind-key -n C-u if -F "#{||:#{==:nvim,#{pane_current_command}},#{==:lazygit,#{pane_current_command}}}" 'send-keys C-u' 'if -F "#{==:#{history_size},0}" "" "copy-mode ; send-keys -X -N 10 scroll-up ; send-keys -X middle-line"'
bind-key -n C-d if -F "#{||:#{==:nvim,#{pane_current_command}},#{==:lazygit,#{pane_current_command}}}" 'send-keys C-d' 'copy-mode ; send-keys -X -N 10 scroll-down ; send-keys -X middle-line ; if -F "#{==:#{scroll_position},0}" "send-keys -X cancel"'

bind v split-window -h -c "#{pane_current_path}"
bind s split-window -v -c "#{pane_current_path}"
# Resize panes with Ctrl+Alt+hjkl
# j/k always resize tmux (no nvim integration)
bind-key -n C-M-j resize-pane -D 5
bind-key -n C-M-k resize-pane -U 5
# h/l pass through to Neovim if active
bind-key -n C-M-h if -F "#{@pane-is-vim}" 'send-keys C-M-h' 'resize-pane -L 5'
bind-key -n C-M-l if -F "#{@pane-is-vim}" 'send-keys C-M-l' 'resize-pane -R 5'
bind c kill-pane
bind q kill-server
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded!"
